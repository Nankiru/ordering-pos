{
	"info": {
		"_postman_id": "khqr-api-collection-2025",
		"name": "KHQR API Collection",
		"description": "Test KHQR payment API endpoints with QR code visualization",
		"schema": "https://schema.getpostman.com/json/collection/v2.1.0/collection.json"
	},
	"item": [
		{
			"name": "1. Create KHQR Code (with QR Preview)",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://127.0.0.1:8000/api/khqr/create?amount=10.50&bakongid=sopheanan_khem@aclb&merchantname=My Shop&currency=USD",
					"protocol": "http",
					"host": [
						"127",
						"0",
						"0",
						"1"
					],
					"port": "8000",
					"path": [
						"api",
						"khqr",
						"create"
					],
					"query": [
						{
							"key": "amount",
							"value": "10.50",
							"description": "Transaction amount (required)"
						},
						{
							"key": "bakongid",
							"value": "sopheanan_khem@aclb",
							"description": "Bakong merchant ID (required)"
						},
						{
							"key": "merchantname",
							"value": "My Shop",
							"description": "Merchant name (required)"
						},
						{
							"key": "currency",
							"value": "USD",
							"description": "Currency code: USD or KHR (optional, default: USD)"
						}
					]
				},
				"description": "Generate KHQR QR code for payment. Returns base64 encoded SVG QR code."
			},
			"response": [],
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"// Visualize QR Code in Postman",
							"var response = pm.response.json();",
							"",
							"if (response.success && response.qr) {",
							"    // Store MD5 for next request",
							"    pm.environment.set('last_md5', response.md5);",
							"    pm.environment.set('last_bakongid', 'sopheanan_khem@aclb');",
							"    ",
							"    // Create HTML template to display QR code",
							"    var template = `",
							"        <!DOCTYPE html>",
							"        <html>",
							"        <head>",
							"            <style>",
							"                body {",
							"                    font-family: 'Segoe UI', Arial, sans-serif;",
							"                    max-width: 800px;",
							"                    margin: 40px auto;",
							"                    padding: 20px;",
							"                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);",
							"                    min-height: 100vh;",
							"                }",
							"                .container {",
							"                    background: white;",
							"                    border-radius: 16px;",
							"                    padding: 40px;",
							"                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);",
							"                }",
							"                h1 {",
							"                    color: #667eea;",
							"                    text-align: center;",
							"                    margin-bottom: 10px;",
							"                    font-size: 32px;",
							"                }",
							"                .subtitle {",
							"                    text-align: center;",
							"                    color: #666;",
							"                    margin-bottom: 30px;",
							"                    font-size: 14px;",
							"                }",
							"                .qr-container {",
							"                    text-align: center;",
							"                    margin: 30px 0;",
							"                    padding: 30px;",
							"                    background: #f8f9fa;",
							"                    border-radius: 12px;",
							"                    border: 3px dashed #667eea;",
							"                }",
							"                .qr-code {",
							"                    max-width: 400px;",
							"                    width: 100%;",
							"                    height: auto;",
							"                    margin: 0 auto;",
							"                    display: block;",
							"                    background: white;",
							"                    padding: 20px;",
							"                    border-radius: 8px;",
							"                    box-shadow: 0 4px 12px rgba(0,0,0,0.1);",
							"                }",
							"                .info-grid {",
							"                    display: grid;",
							"                    grid-template-columns: repeat(2, 1fr);",
							"                    gap: 15px;",
							"                    margin-top: 30px;",
							"                }",
							"                .info-card {",
							"                    background: #f8f9fa;",
							"                    padding: 20px;",
							"                    border-radius: 8px;",
							"                    border-left: 4px solid #667eea;",
							"                }",
							"                .info-card label {",
							"                    display: block;",
							"                    font-weight: 600;",
							"                    color: #667eea;",
							"                    margin-bottom: 8px;",
							"                    font-size: 12px;",
							"                    text-transform: uppercase;",
							"                    letter-spacing: 0.5px;",
							"                }",
							"                .info-card .value {",
							"                    font-size: 16px;",
							"                    color: #333;",
							"                    word-break: break-all;",
							"                    font-family: 'Courier New', monospace;",
							"                }",
							"                .amount-display {",
							"                    text-align: center;",
							"                    font-size: 48px;",
							"                    font-weight: bold;",
							"                    color: #667eea;",
							"                    margin: 20px 0;",
							"                    text-shadow: 2px 2px 4px rgba(0,0,0,0.1);",
							"                }",
							"                .status-badge {",
							"                    display: inline-block;",
							"                    padding: 8px 16px;",
							"                    background: #ffc107;",
							"                    color: #000;",
							"                    border-radius: 20px;",
							"                    font-weight: 600;",
							"                    font-size: 14px;",
							"                    text-transform: uppercase;",
							"                    letter-spacing: 0.5px;",
							"                }",
							"                .success-badge {",
							"                    background: #28a745;",
							"                    color: white;",
							"                }",
							"                .expires-info {",
							"                    text-align: center;",
							"                    margin-top: 20px;",
							"                    padding: 15px;",
							"                    background: #fff3cd;",
							"                    border-radius: 8px;",
							"                    border: 1px solid #ffc107;",
							"                }",
							"                .expires-info strong {",
							"                    color: #856404;",
							"                }",
							"                .instructions {",
							"                    margin-top: 30px;",
							"                    padding: 20px;",
							"                    background: #e7f3ff;",
							"                    border-radius: 8px;",
							"                    border-left: 4px solid #2196F3;",
							"                }",
							"                .instructions h3 {",
							"                    color: #2196F3;",
							"                    margin-top: 0;",
							"                    font-size: 18px;",
							"                }",
							"                .instructions ol {",
							"                    margin: 10px 0;",
							"                    padding-left: 20px;",
							"                }",
							"                .instructions li {",
							"                    margin: 8px 0;",
							"                    color: #333;",
							"                }",
							"                .warning {",
							"                    margin-top: 20px;",
							"                    padding: 15px;",
							"                    background: #ffebee;",
							"                    border-radius: 8px;",
							"                    border-left: 4px solid #f44336;",
							"                    color: #c62828;",
							"                }",
							"                .warning strong {",
							"                    display: block;",
							"                    margin-bottom: 8px;",
							"                }",
							"            </style>",
							"        </head>",
							"        <body>",
							"            <div class='container'>",
							"                <h1>üéâ KHQR Payment QR Code</h1>",
							"                <div class='subtitle'>",
							"                    <span class='status-badge'>‚è≥ PENDING PAYMENT</span>",
							"                </div>",
							"                ",
							"                <div class='amount-display'>",
							"                    $${response.amount} ${response.currency}",
							"                </div>",
							"                ",
							"                <div class='qr-container'>",
							"                    <p style='color: #666; margin-bottom: 15px;'>üì± Scan with Bakong/ABA App</p>",
							"                    <img src='${response.qr}' alt='KHQR Payment QR Code' class='qr-code' />",
							"                </div>",
							"                ",
							"                <div class='expires-info'>",
							"                    ‚è∞ <strong>Expires:</strong> ${response.expires_at}",
							"                </div>",
							"                ",
							"                <div class='info-grid'>",
							"                    <div class='info-card'>",
							"                        <label>Transaction ID</label>",
							"                        <div class='value'>${response.tran}</div>",
							"                    </div>",
							"                    <div class='info-card'>",
							"                        <label>MD5 Hash</label>",
							"                        <div class='value'>${response.md5}</div>",
							"                    </div>",
							"                </div>",
							"                ",
							"                <div class='instructions'>",
							"                    <h3>üìã Testing Instructions:</h3>",
							"                    <ol>",
							"                        <li><strong>Check Status:</strong> Use request #2 to check payment status</li>",
							"                        <li><strong>Simulate Payment:</strong> Use request #3 to mark as paid</li>",
							"                        <li><strong>Scan QR:</strong> Use real Bakong/ABA app (requires real merchant account)</li>",
							"                    </ol>",
							"                </div>",
							"                ",
							"                <div class='warning'>",
							"                    <strong>‚ö†Ô∏è Important Note:</strong>",
							"                    The Bakong ID <code>sopheanan_khem@aclb</code> is a TEST account and does NOT exist in the real Bakong system. Scanning will show \"account not found\" error. To test with real scanning, you need a registered Bakong merchant account.",
							"                </div>",
							"            </div>",
							"        </body>",
							"        </html>",
							"    `;",
							"    ",
							"    pm.visualizer.set(template);",
							"} else {",
							"    pm.visualizer.set('<h1>Error: ' + (response.message || 'Failed to generate QR code') + '</h1>');",
							"}"
						],
						"type": "text/javascript"
					}
				}
			]
		},
		{
			"name": "2. Check Payment Status",
			"request": {
				"method": "GET",
				"header": [],
				"url": {
					"raw": "http://127.0.0.1:8000/api/khqr/check_by_md5?md5={{last_md5}}&bakongid={{last_bakongid}}",
					"protocol": "http",
					"host": [
						"127",
						"0",
						"0",
						"1"
					],
					"port": "8000",
					"path": [
						"api",
						"khqr",
						"check_by_md5"
					],
					"query": [
						{
							"key": "md5",
							"value": "{{last_md5}}",
							"description": "MD5 hash from create request"
						},
						{
							"key": "bakongid",
							"value": "{{last_bakongid}}",
							"description": "Bakong merchant ID"
						}
					]
				},
				"description": "Check payment status using MD5 hash. Returns:\n- responseCode: 0 = paid, 1 = pending"
			},
			"response": [],
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var response = pm.response.json();",
							"",
							"if (response.success) {",
							"    var statusColor = response.responseCode === 0 ? '#28a745' : '#ffc107';",
							"    var statusText = response.responseCode === 0 ? '‚úÖ PAID' : '‚è≥ PENDING';",
							"    var statusIcon = response.responseCode === 0 ? '‚úÖ' : '‚è≥';",
							"    ",
							"    var template = `",
							"        <!DOCTYPE html>",
							"        <html>",
							"        <head>",
							"            <style>",
							"                body {",
							"                    font-family: 'Segoe UI', Arial, sans-serif;",
							"                    max-width: 600px;",
							"                    margin: 40px auto;",
							"                    padding: 20px;",
							"                    background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);",
							"                    min-height: 100vh;",
							"                }",
							"                .container {",
							"                    background: white;",
							"                    border-radius: 16px;",
							"                    padding: 40px;",
							"                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);",
							"                    text-align: center;",
							"                }",
							"                h1 { color: #667eea; margin-bottom: 30px; }",
							"                .status-icon {",
							"                    font-size: 80px;",
							"                    margin: 20px 0;",
							"                }",
							"                .status-text {",
							"                    font-size: 32px;",
							"                    font-weight: bold;",
							"                    color: ${statusColor};",
							"                    margin: 20px 0;",
							"                }",
							"                .info-box {",
							"                    background: #f8f9fa;",
							"                    padding: 20px;",
							"                    border-radius: 8px;",
							"                    margin: 15px 0;",
							"                    text-align: left;",
							"                }",
							"                .info-box label {",
							"                    font-weight: 600;",
							"                    color: #667eea;",
							"                    display: block;",
							"                    margin-bottom: 5px;",
							"                    font-size: 12px;",
							"                    text-transform: uppercase;",
							"                }",
							"                .info-box .value {",
							"                    font-size: 18px;",
							"                    color: #333;",
							"                    font-family: 'Courier New', monospace;",
							"                }",
							"                .response-code {",
							"                    display: inline-block;",
							"                    padding: 10px 20px;",
							"                    background: ${statusColor};",
							"                    color: white;",
							"                    border-radius: 20px;",
							"                    font-weight: 600;",
							"                    margin: 20px 0;",
							"                }",
							"            </style>",
							"        </head>",
							"        <body>",
							"            <div class='container'>",
							"                <h1>Payment Status Check</h1>",
							"                <div class='status-icon'>${statusIcon}</div>",
							"                <div class='status-text'>${statusText}</div>",
							"                <div class='response-code'>Response Code: ${response.responseCode}</div>",
							"                ",
							"                <div class='info-box'>",
							"                    <label>Transaction ID</label>",
							"                    <div class='value'>${response.tran}</div>",
							"                </div>",
							"                ",
							"                <div class='info-box'>",
							"                    <label>Amount</label>",
							"                    <div class='value'>$${response.amount}</div>",
							"                </div>",
							"                ",
							"                <div class='info-box'>",
							"                    <label>Status</label>",
							"                    <div class='value'>${response.status}</div>",
							"                </div>",
							"            </div>",
							"        </body>",
							"        </html>",
							"    `;",
							"    ",
							"    pm.visualizer.set(template);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			]
		},
		{
			"name": "3. Simulate Payment (Testing Only)",
			"request": {
				"method": "POST",
				"header": [
					{
						"key": "Content-Type",
						"value": "application/json"
					}
				],
				"body": {
					"mode": "raw",
					"raw": "{\n    \"md5\": \"{{last_md5}}\"\n}"
				},
				"url": {
					"raw": "http://127.0.0.1:8000/api/khqr/simulate-payment",
					"protocol": "http",
					"host": [
						"127",
						"0",
						"0",
						"1"
					],
					"port": "8000",
					"path": [
						"api",
						"khqr",
						"simulate-payment"
					]
				},
				"description": "Simulate a payment (for testing purposes). Marks the transaction as paid."
			},
			"response": [],
			"event": [
				{
					"listen": "test",
					"script": {
						"exec": [
							"var response = pm.response.json();",
							"",
							"if (response.success) {",
							"    var template = `",
							"        <!DOCTYPE html>",
							"        <html>",
							"        <head>",
							"            <style>",
							"                body {",
							"                    font-family: 'Segoe UI', Arial, sans-serif;",
							"                    max-width: 600px;",
							"                    margin: 40px auto;",
							"                    padding: 20px;",
							"                    background: linear-gradient(135deg, #28a745 0%, #20c997 100%);",
							"                    min-height: 100vh;",
							"                }",
							"                .container {",
							"                    background: white;",
							"                    border-radius: 16px;",
							"                    padding: 40px;",
							"                    box-shadow: 0 20px 60px rgba(0,0,0,0.3);",
							"                    text-align: center;",
							"                }",
							"                h1 { color: #28a745; margin-bottom: 20px; }",
							"                .success-icon {",
							"                    font-size: 100px;",
							"                    margin: 20px 0;",
							"                    animation: bounce 1s;",
							"                }",
							"                @keyframes bounce {",
							"                    0%, 100% { transform: translateY(0); }",
							"                    50% { transform: translateY(-20px); }",
							"                }",
							"                .message {",
							"                    font-size: 24px;",
							"                    color: #28a745;",
							"                    font-weight: 600;",
							"                    margin: 20px 0;",
							"                }",
							"                .next-step {",
							"                    background: #e7f3ff;",
							"                    padding: 20px;",
							"                    border-radius: 8px;",
							"                    margin-top: 30px;",
							"                    border-left: 4px solid #2196F3;",
							"                }",
							"                .next-step h3 {",
							"                    color: #2196F3;",
							"                    margin-top: 0;",
							"                }",
							"            </style>",
							"        </head>",
							"        <body>",
							"            <div class='container'>",
							"                <h1>Payment Simulated Successfully!</h1>",
							"                <div class='success-icon'>‚úÖ</div>",
							"                <div class='message'>${response.message}</div>",
							"                ",
							"                <div class='next-step'>",
							"                    <h3>‚úÖ Next Step:</h3>",
							"                    <p>Now use <strong>Request #2</strong> to check the payment status.</p>",
							"                    <p>It should now show <strong>responseCode: 0</strong> (PAID) ‚ú®</p>",
							"                </div>",
							"            </div>",
							"        </body>",
							"        </html>",
							"    `;",
							"    ",
							"    pm.visualizer.set(template);",
							"}"
						],
						"type": "text/javascript"
					}
				}
			]
		}
	]
}
