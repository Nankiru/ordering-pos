═══════════════════════════════════════════════════════════════════════════
  BAKONG KHQR API - REQUIRED FIELDS & DATA FLOW
═══════════════════════════════════════════════════════════════════════════

┌─────────────────────────────────────────────────────────────────────────┐
│  STEP 1: WHAT YOU NEED TO PROVIDE                                       │
└─────────────────────────────────────────────────────────────────────────┘

Required Fields (3):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

1. 📋 bakongid          (REQUIRED)
   ├─ Type: String
   ├─ Format: account@bank OR +855XXXXXXXXX
   ├─ Examples:
   │  ├─ "mystore@aba"
   │  ├─ "shop123@wing"
   │  ├─ "merchant@aclb"
   │  └─ "+85512345678"
   └─ ⚠️ MUST BE REAL REGISTERED MERCHANT ACCOUNT!

2. 💰 amount             (REQUIRED)
   ├─ Type: Decimal number
   ├─ Min: 0.01
   ├─ Examples:
   │  ├─ 10.50
   │  ├─ 100.00
   │  └─ 5.25
   └─ Description: Payment amount customer needs to pay

3. 🏪 merchantname       (REQUIRED)
   ├─ Type: String
   ├─ Max Length: 25 characters
   ├─ Examples:
   │  ├─ "Coffee Shop"
   │  ├─ "Electronics Store"
   │  └─ "Nan Restaurant"
   └─ Description: Your business name customers see

Optional Fields (1):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

4. 💵 currency           (OPTIONAL)
   ├─ Type: String
   ├─ Default: "USD"
   ├─ Options:
   │  ├─ "USD" - US Dollar
   │  └─ "KHR" - Cambodian Riel
   └─ Description: Payment currency


┌─────────────────────────────────────────────────────────────────────────┐
│  STEP 2: API REQUEST                                                     │
└─────────────────────────────────────────────────────────────────────────┘

Endpoint:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

GET /api/khqr/create

Parameters:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

?amount=10.00
&bakongid=mystore@aba
&merchantname=My%20Store
&currency=USD

Full URL Example:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

http://127.0.0.1:8000/api/khqr/create?amount=10.00&bakongid=mystore@aba&merchantname=My%20Store


┌─────────────────────────────────────────────────────────────────────────┐
│  STEP 3: API RESPONSE                                                    │
└─────────────────────────────────────────────────────────────────────────┘

{
    "success": true,
    "qr": "data:image/svg+xml;base64,PD94bWw...",  ← Display this QR to customer
    "md5": "abc123def456...",                       ← Use for payment checking
    "tran": "TXN20251018123456ABC12345",           ← Unique transaction ID
    "amount": 10.00,
    "currency": "USD",
    "expires_at": "2025-10-18T12:44:56+07:00"      ← QR valid for 10 minutes
}


┌─────────────────────────────────────────────────────────────────────────┐
│  STEP 4: WHAT GETS ENCODED IN THE QR CODE                               │
└─────────────────────────────────────────────────────────────────────────┘

The QR code contains KHQR data in EMVCo format:

Input Data:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

bakongid       = "mystore@aba"
merchantname   = "My Store"
amount         = 10.00
currency       = "USD"

Gets Transformed Into KHQR Tags:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

Tag 00: "01"                          ← Payload format version
Tag 01: "11"                          ← Static QR
Tag 30: (nested)                      ← Merchant account
    ├─ Tag 00: "org.khqr"            ← KHQR identifier
    ├─ Tag 01: "aba"                 ← Bank code (extracted from @aba)
    └─ Tag 02: "mystore"             ← Account (extracted before @)
Tag 52: "5999"                        ← Merchant category (retail)
Tag 53: "840"                         ← Currency (840=USD, 116=KHR)
Tag 54: "10.00"                       ← Amount
Tag 58: "KH"                          ← Country (Cambodia)
Tag 59: "My Store"                    ← Merchant name
Tag 60: "Phnom Penh"                  ← City
Tag 62: (nested)                      ← Additional data
    └─ Tag 05: "TXN20251018..."      ← Transaction reference
Tag 63: "ABCD"                        ← CRC16 checksum


┌─────────────────────────────────────────────────────────────────────────┐
│  STEP 5: CHECKING PAYMENT STATUS                                        │
└─────────────────────────────────────────────────────────────────────────┘

Required Fields:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

md5       ← From create response
bakongid  ← Same as used in create

API Call:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

GET /api/khqr/check_by_md5?md5=abc123&bakongid=mystore@aba

Response (Pending):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

{
    "success": true,
    "responseCode": 1,          ← 1 = PENDING (not paid yet)
    "status": "pending",
    "amount": 10.00
}

Response (Paid):
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

{
    "success": true,
    "responseCode": 0,          ← 0 = PAID (success!)
    "status": "paid",
    "amount": 10.00
}


┌─────────────────────────────────────────────────────────────────────────┐
│  COMPLETE WORKFLOW EXAMPLE                                               │
└─────────────────────────────────────────────────────────────────────────┘

1. Customer Checkout
   ├─ Cart Total: $25.50
   └─ Click "Pay with KHQR"

2. Your System Calls API
   ├─ GET /api/khqr/create
   ├─ Send: amount=25.50, bakongid=mystore@aba, merchantname=My Store
   └─ Receive: QR code + MD5 hash

3. Display QR to Customer
   ├─ Show QR code image
   ├─ Show amount: $25.50
   └─ Show countdown timer (10 minutes)

4. Customer Scans QR
   ├─ Opens Bakong/ABA app
   ├─ Scans QR code
   ├─ Sees: "My Store" - $25.50
   └─ Confirms payment

5. Your System Checks Status (every 5 seconds)
   ├─ GET /api/khqr/check_by_md5?md5=abc123&bakongid=mystore@aba
   ├─ Initially: responseCode=1 (pending)
   └─ After payment: responseCode=0 (paid)

6. Complete Order
   ├─ Payment confirmed!
   ├─ Create order in database
   └─ Show success page


┌─────────────────────────────────────────────────────────────────────────┐
│  CONFIGURATION IN YOUR PROJECT                                           │
└─────────────────────────────────────────────────────────────────────────┘

.env File:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

BAKONG_ID="your_merchant_account@aba"
BAKONG_MERCHANT_NAME="Your Store Name"

Usage in Code:
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━━

$bakongid = env('BAKONG_ID');
$merchantname = env('BAKONG_MERCHANT_NAME');


┌─────────────────────────────────────────────────────────────────────────┐
│  SUMMARY - MINIMUM REQUIRED FIELDS                                       │
└─────────────────────────────────────────────────────────────────────────┘

To create a Bakong KHQR payment, you ONLY need 3 things:

┌────────────────┬──────────────┬────────────────────┐
│ Field          │ Required?    │ Example            │
├────────────────┼──────────────┼────────────────────┤
│ bakongid       │ ✅ YES       │ mystore@aba        │
│ merchantname   │ ✅ YES       │ My Store           │
│ amount         │ ✅ YES       │ 10.50              │
│ currency       │ ❌ NO        │ USD (default)      │
└────────────────┴──────────────┴────────────────────┘

That's it! Just 3 fields to accept payments! 🎉


┌─────────────────────────────────────────────────────────────────────────┐
│  IMPORTANT REMINDERS                                                     │
└─────────────────────────────────────────────────────────────────────────┘

⚠️  bakongid MUST be a REAL registered merchant account
    Example: mystore@aba, shop@wing, +85512345678

⚠️  Test account "sopheanan_khem@aclb" is NOT real
    You'll get "account not visible" error

✅  For testing: Use payment simulator at /khqr-simulator
✅  For production: Get real merchant account from Bakong

═══════════════════════════════════════════════════════════════════════════
